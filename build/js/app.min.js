$('#modal').animatedModal({modalTarget:'optionsModal',animatedIn:'lightSpeedIn',animatedOut:'bounceOutDown',color:'#40793e'});var iconShowing,animationEnd='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';$(document).ready(function(){loadSettings(),extensionManifest=chrome.runtime.getManifest(),$('#version').text('v'+extensionManifest.version),updateClock(),getGeolocation(),getQuote(),handleOptionsModal(),$('#digital_clock').bind('click',function(){clockToggle&&'digital'===clockType&&(clockFormat=12==clockFormat?24:12,updateClock())}),$('#refresh').bind('click',function(){getQuote()}),$('.flipper-container').bind('click',function(){$('.flipper-container').toggleClass('flip')}),$('#save_settings').bind('click',function(){weatherAppId=$('#weatherAppId').val(),saveSettings(),$('.close-optionsModal').click(),getWeather()}),$('#search_button').bind('click',search),$('#search_input').on('keydown',function(b){(13==b.which||13==b.keycode)&&search()}),setInterval(function(){$('.flipper-container').toggleClass('flip')},30000),setInterval('updateClock()',1e3),setInterval('getQuote()',300000),setInterval('getWeather()',90000),navigator.onLine||setTimeout(displayWeather,2e3)});var search=function(){var b=$('#search_input').val();$('#search_input').val('');b&&('Google'===searchEngine?window.location.href='http://google.com/search?q='+b:'Bing'===searchEngine?window.location.href='http://bing.com/search?q='+b:'Yahoo!'===searchEngine?window.location.href='https://search.yahoo.com/search?p='+b:void 0)},loadSettings=function(){chrome.storage.sync.get({searchEnable:!0,searchEngine:'Google',quoteEnable:!0,optionsColor:'#40793e',navColor:'#6d4c2e',navLinks:['facebook'],clockEnable:!0,clockFormat:'12',clockToggle:!1,clockType:'digital',weatherEnable:!0,weatherUnits:'F',weatherTimestamp:0,weather:{},weatherAppId:null,geolocation:{}},function(b){console.log(b),$('#searchEnable').attr('checked',searchEnable=b.searchEnable),$('#searchEngine').val(searchEngine=b.searchEngine),$('#quoteEnable').attr('checked',quoteEnable=b.quoteEnable),$('#optionsColor').val(optionsColor=b.optionsColor),$('#navColor').val(navColor=b.navColor),$('#navLinks').val(navLinks=b.navLinks),$('#clockEnable').attr('checked',clockEnable=b.clockEnable),$('#clockFormat').val(clockFormat=b.clockFormat),$('#clockToggle').attr('checked',clockToggle=b.clockToggle),$('#clockType').val(clockType=b.clockType),$('#weatherEnable').attr('checked',weatherEnable=b.weatherEnable),$('#weatherUnits').val(weatherUnits=b.weatherUnits),$('#weatherAppId').val(weatherAppId=b.weatherAppId),weatherTimestamp=b.weatherTimestamp,geolocation=b.geolocation,weather=b.weather,updateUI()})},saveSettings=function(){chrome.storage.sync.set({searchEnable,searchEngine,quoteEnable,optionsColor,navColor,navLinks,clockEnable,clockFormat,clockToggle,clockType,weatherEnable,weatherUnits,weatherAppId},function(){$.amaran({theme:'colorful',content:{bgcolor:'#27ae60',color:'#fff',message:'Settings saved successully'},position:'bottom right',outEffect:'slideBottom'})})},saveTimestamp=function(){chrome.storage.sync.set({weatherTimestamp})},saveLocation=function(){chrome.storage.sync.set({geolocation})},saveWeather=function(){chrome.storage.sync.set({weather})},handleOptionsModal=function(){$('#searchEnable').bind('click',function(){searchEnable=$('#searchEnable').prop('checked'),updateUI()}),$('#searchEngine').bind('click',function(){searchEngine=$('#searchEngine').val(),updateUI()}),$('#quoteEnable').bind('click',function(){quoteEnable=$('#quoteEnable').prop('checked'),updateUI()}),$('#optionsColor').on('change',function(){optionsColor=$('#optionsColor').val(),updateUI()}),$('#navColor').on('change',function(){navColor=$('#navColor').val(),updateUI()}),$('#navLinks').on('change',function(){navLinks=$('#navLinks').val(),updateUI()}),$('#clockEnable').bind('click',function(){clockEnable=$('#clockEnable').prop('checked'),updateUI()}),$('#clockFormat').bind('click',function(){clockFormat=parseInt($('#clockFormat').val())}),$('#clockToggle').bind('click',function(){clockToggle=$('#clockToggle').is(':checked'),clockFormat=parseInt($('#clockFormat').val())}),$('#clockType').bind('click',function(){clockType=$('#clockType').val(),updateUI()}),$('#weatherEnable').bind('click',function(){weatherEnable=$('#weatherEnable').prop('checked'),updateUI()}),$('#weatherUnits').bind('click',function(){weatherUnits=$('#weatherUnits').val(),getGeolocation()})},updateUI=function(){searchEnable?($('.search-box').addClass('active'),$('#searchEngine').parents('div.option_element').addClass('active')):($('.search-box').removeClass('active'),$('#searchEngine').parents('div.option_element').removeClass('active')),$('#search_input').attr('placeholder','Search '+searchEngine+'...'),quoteEnable?$('.quote').addClass('active'):$('.quote').removeClass('active'),$('#optionsColor').parents('label.color').css('background',optionsColor),$('#optionsModal').css('background',optionsColor),$('.modalContainer').css('color',optionsColor),$('.modalContainer legend').css('color',optionsColor),$('.modalContainer option').css('color',optionsColor),$('.modalContainer select').css('color',optionsColor),$('#navColor').parents('label.color').css('background',navColor),$('nav').css('background',navColor),$('nav').empty(),navLinks.forEach(function(b){var c=$('<a>').attr('href',$('[value=\''+b+'\']').data('link')).appendTo($('nav')),d=$('<i>').addClass('fa fa-'+b.toLowerCase()+' fa-4x').appendTo(c)}),clockEnable?$('#clockType').parents('div.option_element').addClass('active'):($('#clockType').parents('div.option_element').removeClass('active'),$('#clockFormat').parents('div.option_element').removeClass('active'),$('#clockToggle').parents('div.option_element').removeClass('active'),$('#analog_clock').removeClass('active'),$('#digital_clock').removeClass('active')),clockEnable&&'digital'===clockType?($('#digital_clock').addClass('active'),$('#analog_clock').removeClass('active'),$('#clockFormat').parents('div.option_element').addClass('active'),$('#clockToggle').parents('div.option_element').addClass('active')):clockEnable&&'analog'===clockType&&($('#analog_clock').addClass('active'),$('#digital_clock').removeClass('active'),$('#clockFormat').parents('div.option_element').removeClass('active'),$('#clockToggle').parents('div.option_element').removeClass('active')),weatherEnable?($('#weather').addClass('active'),$('#weatherUnits').parents('div.option_element').addClass('active'),$('#weatherAppId').parents('div.option_element').addClass('active')):($('#weather').removeClass('active'),$('#weatherUnits').parents('div.option_element').removeClass('active'),$('#weatherAppId').parents('div.option_element').removeClass('active'))},getQuote=function(){$.ajax({method:'get',type:'json',url:'https://andruxnet-random-famous-quotes.p.mashape.com/?cat=famous',headers:{'X-Mashape-Key':'fdsv5ceSE2mshy4trzTyQNdsdh7rp1L6vaNjsnlfpuequ1zlJl'},success:function(b){setQuote(b.quote,b.author)},error:function(){setQuote('Well done is better than well said.','Benjamin Franklin')}})},setQuote=function(b,c){$('#quote-text').text(b),''===c&&(c='Unknown'),$('#quote-author').text(c)},getGeolocation=function(){navigator.geolocation.getCurrentPosition(function(b){geolocation.coords={lat:b.coords.latitude,long:b.coords.longitude},saveLocation(),getCityName()})},getCityName=function(){navigator.onLine?$.ajax({url:'http://maps.googleapis.com/maps/api/geocode/json?latlng='+geolocation.coords.lat+','+geolocation.coords.long+'&sensor=true',success:function(b){$.each(b.results[0].address_components,function(c,d){d.types.includes('locality')?city=d.long_name:d.types.includes('administrative_area_level_1')&&(state=d.short_name)}),geolocation.place=city+', '+state,saveLocation()},complete:function(){getWeather()}}):getWeather()},getWeather=function(){console.log('Updating weather'),currentTimestamp=+new Date,currentTimestamp>weatherTimestamp+6e5||$.isEmptyObject(weather)?(weatherTimestamp=+new Date,saveTimestamp(),navigator.onLine?($.ajax({url:`http://api.openweathermap.org/data/2.5/weather?lat=${geolocation.coords.lat}&lon=${geolocation.coords.long}&appid=${weatherAppId}`,success:function(b){weatherEnable&&$('#weather').addClass('active'),weather={temp:b.main.temp,icon:b.weather[0].id,wind:{deg:b.wind.deg,speed:b.wind.speed},sunrise:b.sys.sunrise,sunset:b.sys.sunset}},error:function(b){'401'==b.status&&($.amaran({theme:'colorful',content:{bgcolor:'#f44b42',color:'#fff',message:'Unable to fetch weather.  Please provide API key in settings.'},position:'bottom right',outEffect:'slideBottom'}),$('#weather').removeClass('active'))}}),$.ajax({url:`http://api.openweathermap.org/data/2.5/forecast/daily?cnt=3&lat=${geolocation.coords.lat}&lon=${geolocation.coords.long}&appid=${weatherAppId}`,success:function(b){console.log(b);let c=[];b.list.forEach(function(d){c.push({temp:d.temp.max,icon:d.weather[0].id,timestamp:d.dt})}),weather.forecast=c}}),saveWeather(),displayWeather()):displayWeather()):displayWeather()},displayWeather=function(){$('#location').text(geolocation.place);var b=+new Date;b/1e3>=weather.sunrise&&b/1e3<=weather.sunset?$('#icon').addClass('owf-'+weather.icon+'-d'):$('#icon').addClass('owf-'+weather.icon+'-n'),$('#icon').addClass('animated fadeIn'),'F'===weatherUnits?$('#temperature').text(Math.round(weather.temp*(9/5)-459.67)):$('#temperature').text(Math.round(weather.temp-273.15)),$('#wind').addClass('wi-wind').addClass('from-'+weather.wind.deg+'-deg');for(var c=1;3>=c;c++)forecastItem(c);iconShowing=!0,setInterval('toggleForecast()',5000)},forecastItem=function(b){let c=new Date(1e3*weather.forecast[b-1].timestamp);$('#'+b+' span').text(['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][c.getDay()]),$('#'+b+' i').addClass('active owf owf-'+weather.forecast[b-1].icon+'-d'),'F'===weatherUnits?$('#'+b+' p').text(Math.round(weather.forecast[b-1].temp*(9/5)-459.67)):$('#'+b+' p').text(Math.round(weather.forecast[b-1].temp-273.15))},toggleForecast=function(){iconShowing=!iconShowing;for(var b=[],c=0;3>c;c++)b.push($('#'+(c+1)));b.forEach(function(d){iconShowing?d.find('p').addClass('animated fadeOut').one(animationEnd,function(){d.find('p').removeClass('animated fadeOut').removeClass('active'),d.find('i').addClass('active').addClass('animated fadeIn').one(animationEnd,function(){d.find('i').removeClass('animated fadeIn')})}):d.find('i').addClass('animated fadeOut').one(animationEnd,function(){d.find('i').removeClass('animated fadeOut').removeClass('active'),d.find('p').addClass('active').addClass('animated fadeIn').one(animationEnd,function(){d.find('p').removeClass('animated fadeIn')})})})},updateClock=function(){var b=new Date,c=b.getHours(),d=b.getMinutes(),f=b.getSeconds();sdeg=360*(f/60),mdeg=360*(d/60)+f/60,hdeg=360*(c/12)+30*(d/60),d=10>d?'0'+b.getMinutes():b.getMinutes(),12==clockFormat?(c=12<b.getHours()?b.getHours()-12:b.getHours(),0==b.getHours()&&(c=12)):c=b.getHours(),$('#digital_clock h1').text(c+':'+d),$('.second').css('transform','rotate('+sdeg+'deg)'),$('.minute').css('transform','rotate('+mdeg+'deg)'),$('.hour').css('transform','rotate('+hdeg+'deg)')};